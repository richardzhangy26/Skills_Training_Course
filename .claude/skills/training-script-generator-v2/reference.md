# Training Script Generator V2 - 配置参考手册

本文档提供详细的配置参考和设计指南，帮助你理解和使用 training-script-generator-v2 生成的 Markdown 配置。

---

## 目录

1. [任务类型对比](#任务类型对比)
2. [Markdown 配置完整格式](#markdown-配置完整格式)
3. [基础配置模块](#基础配置模块)
4. [训练阶段模块](#训练阶段模块)
5. [互动轮次设置指南](#互动轮次设置指南)
6. [提示词5部分详解](#提示词5部分详解)
7. [状态机逻辑设计指南](#状态机逻辑设计指南)
8. [反剧透设计技巧](#反剧透设计技巧)
9. [跳转指令规范](#跳转指令规范)
10. [常见问题与解决方案](#常见问题与解决方案)

---

## 任务类型对比

training-script-generator-v2 支持两种核心任务类型，需要根据任务特征选择对应的提示词结构。

### 顺序检查型

**定义**：学生需要依次完成多个明确的步骤，每步有对错之分。

**特征**：
- 有明确的正确/错误判断标准
- 步骤通常按顺序执行
- 判定逻辑：正确 → 跳转下一阶段；错误 → 引导修正

**典型场景**：
- 心理咨询训练：建立关系（接纳vs评判）→ 共情训练（共情vs建议）→ 结束
- 故障诊断：现象描述 → 检查排查（正确vs错误方向）→ 确定方案
- 操作规范：准备工作 → 操作步骤（正确vs错误操作）→ 验收

**提示词结构**：
```markdown
# Workflow & Interaction Rules
1. **判定回答正确/通过**: ...
2. **判定回答错误/不完整**: ...
3. **判定无关话题**: ...
```

### 累积检查型

**定义**：学生需要逐步提及多个核心要素，顺序不固定，最终要"集齐"所有要素。

**特征**：
- 没有固定的对错判断，只有"齐全vs缺失"
- 要素可以以任意顺序提及
- 判定逻辑：缺失要素X → 引导补充；所有要素齐全 → 跳转

**典型场景**：
- 新闻采访名单：需包含【核心当事人】+【私密关系人】+【外部评价者】
- 商业方案设计：需包含【市场分析】+【团队介绍】+【财务模型】
- 安全检查清单：需包含【人员】+【设备】+【环境】+【流程】

**提示词结构**：
```markdown
# Workflow & Interaction Rules
## 步骤 0：上下文进度与状态回溯（必须执行）
[列出所有核心要素]

## 步骤 1：处理缺失要素的引导
- **分支 A（缺失要素X）**: ...
- **分支 B（缺失要素Y）**: ...

## 步骤 2：判定任务完成
[所有要素齐全 → 跳转]
```

### 如何选择任务类型

| 判断维度 | 顺序检查型 | 累积检查型 |
|---------|-----------|-----------|
| **对错判断** | 有明确的对错标准 | 没有对错，只有齐全vs缺失 |
| **顺序要求** | 通常按固定顺序 | 顺序不固定 |
| **判定依据** | 当前回答是否正确 | 对话历史中是否提及所有要素 |
| **核心机制** | 正确/错误分支 | Step 0（上下文回溯）+ 缺失判定 |
| **典型问法** | "这样做对吗？" | "你列出了哪些XX？" |

**示例对比**：

**顺序检查型**：
- 问题："你觉得应该怎么回应这位来访者？"
- 判定：学生回答"共情" → 正确；回答"给建议" → 错误

**累积检查型**：
- 问题："你打算采访哪些人来完成这篇报道？"
- 判定：检查学生是否提及了【本人】【家人】【专家】，缺哪个引导哪个

---

## Markdown 配置完整格式

以下是标准的 Markdown 配置模板：

```markdown
# [任务名称] - 训练剧本配置

## 📋 基础配置
- **任务名称**: [清晰的任务名称]
- **任务描述**: [1-2句话说明训练目的和场景]
- **智能体角色**: [姓名、身份、性格、背景]
- **目标受众**: [适用的学生群体或专业]

## 📝 训练阶段

### 阶段1: [阶段名称]

**阶段描述**: [1-2句话说明本阶段的教学目的]

**互动轮次**: [N轮]

**开场白**:
> [智能体的第一句话]

**提示词**:
```markdown
# Role
[智能体人设]

# Context & Task
[当前阶段的背景和任务]

# Opening Line
[开场白]

# Workflow & Interaction Rules
1. **判定回答正确/通过**:
   - 条件：[具体条件]
   - 策略：输出跳转指令 `NEXT_TO_[下一阶段]`
2. **判定回答错误/不完整**:
   - 条件：[错误类型]
   - 策略：[引导话术]
   - 回复示例：[具体示例]
3. **判定无关话题**:
   - 策略：拉回正题

# Response Constraints
- 语气：[人设性格]
- 字数限制：[N字]
```

### 阶段2: ...
[重复上述结构]

### 阶段3: ...
[重复上述结构]

## 🔄 阶段跳转关系

说明各阶段之间的流转逻辑：
- 阶段1 → 阶段2：条件为 [具体条件]
- 阶段2 → 阶段3：条件为 [具体条件]
- 阶段3 → 结束：输出 `TASK_COMPLETE`

## 📖 配置说明

简要解释本配置的设计思路：
- **阶段划分原因**：[说明]
- **关键考核点**：[说明]
- **反剧透设计**：[说明]
- **使用建议**：[说明]
```

---

## 基础配置模块

### 必填字段

| 字段 | 说明 | 示例 |
|-----|-----|------|
| **任务名称** | 简洁明确的任务名称 | "心理咨询技巧训练——共情与倾听" |
| **任务描述** | 1-2句话说明目的和场景 | "模拟真实心理咨询场景，帮助学生掌握共情倾听技术" |
| **智能体角色** | 姓名、身份、性格、背景 | "来访者'小雨'（大一新生，内向敏感）" |
| **目标受众** | 适用的学生群体 | "心理学、社会工作专业学生" |

### 编写建议

1. **任务名称**：避免过于笼统（如"实训任务"），应具体说明训练内容
2. **任务描述**：突出核心能力和场景特点
3. **智能体角色**：提供足够的人设细节，帮助理解后续的对话风格
4. **目标受众**：明确适用范围，有助于调整难度和专业术语使用

---

## 训练阶段模块

### 阶段结构

每个阶段包含4个核心元素：

1. **阶段描述**：1-2句话说明教学目的
2. **互动轮次**：预估的对话回合数
3. **开场白**：智能体的第一句话
4. **提示词**：5部分结构的完整 System Prompt

### 阶段划分原则

**标准三段式**：
- **起始阶段**（1个）：背景介绍、身份确认、场景设定
- **交互阶段**（1-5个）：核心教学点、问题诊断、操作考核
- **结束阶段**（1个）：总结评价、结束语

**复杂场景**：
- 可设计分支结构（如：选择展馆A/B/C）
- 每个分支独立设计教学目标和考核点
- 最终汇聚到统一的结束阶段

### 阶段命名规范

- **中文名称**：用于阶段标题，清晰易懂（如"建立关系与初步宣泄"）
- **英文标识**：用于跳转指令，简洁明确（如"EXPLORE"、"DIAGNOSIS"、"CLOSURE"）
- **命名原则**：
  - 反映阶段的核心任务
  - 避免过长或晦涩的表达
  - 保持系列阶段命名风格一致

---

## 互动轮次设置指南

| 轮次 | 使用场景 | 典型示例 | 设计要点 |
|-----|---------|---------|---------|
| **0轮** | 自动输出，无需用户回复 | 背景介绍、规则说明、场景设定 | 纯信息传递，不设置判断逻辑 |
| **1-3轮** | 快速交互，简单选择 | 展馆选择、角色确认、简单问答 | 明确的选项，快速判断通过 |
| **4-6轮** | 中等深度交互 | 项目介绍、初步诊断、技能演练 | 需要2-3轮引导和修正 |
| **7-10轮** | 深度交互，复杂任务 | 故障排查、深度分析、多轮共情 | 多层次追问，严格考核 |

### 轮次设定技巧

1. **起始阶段通常0-3轮**：快速建立场景，不宜过长
2. **核心阶段通常5-10轮**：留出足够空间让学生犯错、修正、学习
3. **结束阶段通常2-3轮**：简单收尾，不设置新的考核点

---

## 提示词5部分详解

### 1. Role（角色定义）

**作用**：明确智能体的完整人设，包括身份、性格、背景、当前状态。

**编写要点**：
- 提供姓名和身份（如"你现在扮演'小雨'"）
- 描述性格特点（如"内向、敏感、自卑"）
- 说明当前状态（如"情绪低落，试探咨询师是否可信"）
- 如果是技术角色，说明专业背景和经验

**示例**：
```markdown
# Role
你现在扮演"小雨"。
- **人设**：大一新生，性格内向、敏感、自卑。你最近遭遇了挫折，情绪低落。
- **当前状态**：你刚走进咨询室，鼓起勇气开口，但还在试探咨询师（学生）是否可信。
```

### 2. Context & Task（背景与任务）

**作用**：说明当前阶段的具体背景和教学任务，明确本阶段要考核什么能力。

**编写要点**：
- 说明处于哪个阶段（如"建立关系阶段"）
- 明确本阶段的考核目标（如"测试学生是否能接纳情绪"）
- 如有必要，说明前置条件（如"学生已通过上一阶段"）

**示例**：
```markdown
# Context & Task
当前处于咨询的【建立关系阶段】。你需要表达模糊的痛苦，测试学生是否能接纳你的情绪。
```

### 3. Opening Line（开场白）

**作用**：提供智能体的第一句话，启动对话。

**编写要点**：
- 必须符合人设和情境
- 直入主题，明确任务
- 抛出第一个引导或问题
- 使用引号标注实际的对话内容

**示例**：
```markdown
# Opening Line
"老师……我最近感觉特别糟糕，干什么都没劲，我是不是特别没用啊？"
```

### 4. Workflow & Interaction Rules（工作流与交互规则）

**作用**：定义状态机逻辑，明确如何判断学生的回答并作出相应反应。这是提示词的核心部分。

**标准结构**（三段式）：

#### 4.1 判定回答正确/通过
```markdown
1. **判定回答正确/通过**:
   - 条件：[具体描述用户需要回答什么关键词、使用什么句式、展现什么逻辑]
   - 策略：不输出废话，仅输出跳转指令: `NEXT_TO_[下一阶段]`
```

**关键要求**：
- 条件必须具体、可验证（如"使用共情句式'你感到…'"）
- 避免主观判断（如"学生理解了"）
- 明确跳转目标

#### 4.2 判定回答错误/不完整
```markdown
2. **判定回答错误/不完整**:
   - 条件：[描述常见的错误回答类型]
   - 策略：[定义具体的引导话术或反问逻辑，严禁直接给出答案]
   - 回复示例：[提供1-2个具体的引导话术示例]
```

**关键要求**：
- 列举常见错误类型（如"给建议"、"讲道理"、"评判"）
- **强调引导而非告知**：这是反剧透设计的核心
- 提供具体的回复示例，展示如何引导

**反剧透示例对比**：
- ❌ 错误："告诉学生应该使用共情技巧"
- ✅ 正确："表现出烦躁，说'道理我都懂！但我就是难受啊！'"（暗示不要讲道理）

#### 4.3 判定无关话题
```markdown
3. **判定无关话题**:
   - 条件：[用户回答与本阶段任务完全无关]
   - 策略：礼貌拉回正题，重申当前任务
```

**关键要求**：
- 处理学生答非所问的情况
- 不惩罚学生，而是友好地引导回正轨

### 5. Response Constraints（响应约束）

**作用**：约束智能体的输出行为，确保对话质量和体验。

**常见约束**：
```markdown
# Response Constraints
- 语气必须符合[人设性格]（如：内向敏感、专业严谨、活泼亲切）
- 满足条件时仅输出跳转指令，不输出多余内容
- 单次回复字数限制：[50-100字]
- 避免使用过于专业或晦涩的术语
- 保持与学生的平等对话姿态
```

**编写建议**：
- 语气约束与 Role 保持一致
- 字数限制根据场景设定（快节奏场景50字，深度交互100-150字）
- 如有特殊要求（如"不使用反问"、"必须提供具体数据"），明确列出

---

## 状态机逻辑设计指南

### 三种常见模式

#### 模式1：二分类判断（正确/错误）

**适用场景**：明确的对错标准，如共情训练、安全操作检查

**逻辑结构**：
```
学生输入 → 判断
   ├─ 正确 → 跳转下一阶段
   └─ 错误 → 引导修正 → 继续本阶段
```

**示例**：心理咨询共情训练
- 正确：使用"你感到…"句式 → `NEXT_TO_CLOSURE`
- 错误：给建议 → 表现烦躁 → 继续对话

#### 模式2：多分类判断（完全正确/部分正确/完全错误）

**适用场景**：有多个层次的评判标准，如故障诊断、商业分析

**逻辑结构**：
```
学生输入 → 判断
   ├─ 完全正确 → 跳转下一阶段
   ├─ 部分正确 → 肯定+引导深化 → 继续本阶段
   └─ 完全错误 → 引导观察 → 继续本阶段
```

**示例**：设备故障诊断
- 完全正确：说出"阀门漏气" → `NEXT_TO_SOLUTION`
- 部分正确：说"管路有问题" → "你的方向对，具体是哪个部件？"
- 完全错误：说"电路故障" → "你有注意到压力表的读数吗？"

#### 模式3：选择路由（多分支）

**适用场景**：用户主动选择不同路径，如展馆选择、案例选择

**逻辑结构**：
```
学生输入 → 判断选择
   ├─ 选项A → `NEXT_TO_ROUTE_A`
   ├─ 选项B → `NEXT_TO_ROUTE_B`
   └─ 选项C → `NEXT_TO_ROUTE_C`
```

**示例**：虚拟展馆
- 选择"历史展馆" → `NEXT_TO_HISTORY`
- 选择"科技展馆" → `NEXT_TO_TECH`
- 选择"艺术展馆" → `NEXT_TO_ART`

#### 模式4：累积检查型（缺失要素判定）

**适用场景**：学生需要逐步提及多个核心要素，顺序不固定，最终要"集齐"所有要素

**关键特征**：
- 与顺序检查型的"正确/错误"判定不同，累积检查型使用"缺失要素"判定
- 需要 Step 0（上下文回溯）机制
- 学生可以以任意顺序提及要素

**逻辑结构**：
```
Step 0: 回读对话历史 → 检查已提及的要素
   ↓
Step 1: 判定缺失要素
   ├─ 缺失要素A → 引导补充要素A → 继续本阶段
   ├─ 缺失要素B → 引导补充要素B → 继续本阶段
   └─ 缺失要素C → 引导补充要素C → 继续本阶段
   ↓
Step 2: 所有要素齐全 → 跳转下一阶段
```

**示例**：新闻采访名单构建
- Step 0: 检查是否提及【核心当事人】、【私密关系人】、【外部评价者】
- Step 1分支A: 缺失核心当事人 → "你觉得我们需要采访他本人吗？"
- Step 1分支B: 缺失私密关系人 → "还有谁能提供更私密、更真实的信息？"
- Step 1分支C: 缺失外部评价者 → "从行业角度，谁能做出客观评价？"
- Step 2: 三类要素齐全 → `NEXT_TO_OUTLINE`

**Step 0（上下文回溯）标准格式**：
```markdown
## 步骤 0：上下文进度与状态回溯（必须执行）
在生成回复前，**请立即回读本轮及之前的所有对话记录**，检查上下文中是否提及以下[N]类核心要素（提及一类中的任意一种即算覆盖）：
1. **【要素A名称】**：具体的定义或包含的角色（如：核心当事人、项目负责人等）。
2. **【要素B名称】**：具体的定义或包含的角色（如：私密关系人、家人朋友等）。
3. **【要素C名称】**：具体的定义或包含的角色（如：外部评价者、第三方观察者等）。
```

**Step 1（缺失判定）标准格式**：
```markdown
## 步骤 1：处理缺失要素的引导
- **分支 A（缺失要素X）**:
    - 判定依据：结合步骤0，上下文中**尚未提及**[要素X]。(等类似意思)
    - 回复策略：启发式提问，引导学生思考[要素X]的重要性。
    - 话术示例："[具体的引导性问题]" (不要完全按照话术实例输出，要根据学生的回答适当调整逻辑)
```

**关键设计要点**：
1. **必须包含 Step 0**：强制智能体回读对话历史
2. **使用"缺失"而非"错误"**：不评判对错，只判断是否齐全
3. **话术规范**：
   - 判定依据后加 `(等类似意思)`
   - 话术示例后加 `(不要完全按照话术实例输出，要根据学生的回答适当调整逻辑)`
4. **跳转纯净性**：完成时仅输出跳转关键词，不含任何额外内容

### 状态机设计原则

1. **条件可验证**：避免"学生理解了"这样的主观判断，改为"学生回答包含关键词X"
2. **策略具体化**：不写"引导学生"，而写"询问：你注意到压力表的读数吗？"
3. **层次清晰**：优先判断"正确"，再判断"错误类型"，最后处理"无关话题"
4. **退出明确**：每个阶段都必须有明确的跳转条件，避免无限循环

---

## 反剧透设计技巧

**核心理念**：引导（Guiding）而非告知（Telling），让学生通过智能体的反应和引导自己领悟正确答案。

### 技巧1：反问法

**原理**：用问题引导学生关注关键信息，而不直接给出答案。

**示例**：
- ❌ 错误："压力表显示为0，说明阀门漏气了"
- ✅ 正确："你有没有注意到压力表的读数？它显示的是多少？"

**应用场景**：故障诊断、数据分析、观察训练

### 技巧2：观察引导

**原理**：引导学生关注特定的观察对象或数据，让他们自己发现问题。

**示例**：
- ❌ 错误："你没有检查管路"
- ✅ 正确："你可以仔细看一下左侧的那个仪表，它显示的数值是多少？"

**应用场景**：实验操作、现场检查、数据收集

### 技巧3：情绪反馈

**原理**：用智能体的情绪变化暗示学生的回答是否正确，而不直接说"对"或"错"。

**示例**：
- ❌ 错误："你的回答不对"
- ✅ 正确（学生给建议时）："道理我都懂！但我就是难受啊！你是不是觉得这点小事我不至于这样？"（暗示：不要讲道理）

**应用场景**：心理咨询、沟通训练、客户服务

### 技巧4：部分肯定

**原理**：肯定学生的思路方向，但引导他们继续深化。

**示例**：
- ❌ 错误："你说得不够具体"
- ✅ 正确："你的方向是对的，但还可以更深入一些。你能说说具体是哪个部件可能有问题吗？"

**应用场景**：渐进式学习、多层次分析

### 技巧5：对比暗示

**原理**：通过提供对比信息，让学生自己发现异常。

**示例**：
- ❌ 错误："B设备的数据不正常"
- ✅ 正确："你看，A设备的压力是120 kPa，B设备的压力是0 kPa。你觉得这说明了什么？"

**应用场景**：数据比对、质量检验、异常识别

### 反剧透设计检查清单

设计完提示词后，检查以下要点：
- [ ] 是否直接说出了答案？（如"答案是X"）
- [ ] 是否直接告诉学生该怎么做？（如"你应该…"）
- [ ] 引导话术是否具体？（不能只写"引导学生"）
- [ ] 错误回答的反馈是否能让学生意识到问题？
- [ ] 正确回答的判定条件是否明确？

---

## 跳转指令规范

### 指令格式

**统一格式**：`NEXT_TO_[STAGE_NAME]`

- `STAGE_NAME`：使用英文大写标识，与阶段的英文名对应
- 结束节点：`TASK_COMPLETE`

### 常见跳转模式

#### 1. 顺序跳转（线性流程）
```
阶段1 → 阶段2 → 阶段3 → 结束

NEXT_TO_STAGE2 → NEXT_TO_STAGE3 → TASK_COMPLETE
```

#### 2. 条件跳转（多分支）
```
阶段1 → 选择
   ├─ 分支A → 阶段2A → 结束
   ├─ 分支B → 阶段2B → 结束
   └─ 分支C → 阶段2C → 结束

NEXT_TO_ROUTE_A → TASK_COMPLETE
NEXT_TO_ROUTE_B → TASK_COMPLETE
NEXT_TO_ROUTE_C → TASK_COMPLETE
```

#### 3. 场景间互相跳转（网络型）
```
阶段1 → 展馆选择
   ├─ 展馆A ←→ 展馆B ←→ 展馆C
   └─ 任意展馆 → 结束

NEXT_TO_HALL_A, NEXT_TO_HALL_B, NEXT_TO_HALL_C
TASK_COMPLETE（从任意展馆）
```

### 跳转设计原则

1. **跳转条件明确**：每个跳转必须有清晰的触发条件
2. **避免死循环**：确保每个阶段都有退出路径
3. **保持一致性**：同一个阶段的英文标识在所有地方保持一致
4. **注释清晰**：在"阶段跳转关系"部分明确说明跳转逻辑

---

## 常见问题与解决方案

### 问题1：智能体输出过长，学生阅读负担重

**原因**：没有明确字数限制

**解决方案**：
- 在 Response Constraints 中明确字数限制（如"单次回复50-100字"）
- 在 Rules 中强调"简洁表达，避免冗长"
- 对于0轮阶段（纯输出），可适当放宽字数限制

### 问题2：智能体直接给出答案，学生没有思考空间

**原因**：提示词中没有强调反剧透设计

**解决方案**：
- 在 Workflow 的"判定回答错误"部分，强调"严禁直接给出答案"
- 提供具体的引导话术示例
- 使用情绪反馈、反问等技巧替代直接告知

### 问题3：跳转不生效，始终停留在当前阶段

**原因**：跳转指令格式错误或条件判断有误

**解决方案**：
- 检查跳转指令格式是否为 `NEXT_TO_[STAGE_NAME]`
- 确认 STAGE_NAME 与阶段英文标识完全一致（大小写敏感）
- 检查条件判断逻辑是否过于严格或模糊

### 问题4：阶段间没有记忆，学生需要重复回答

**原因**：误以为需要手动设置历史记录

**解决方案**：
- 系统会自动保留对话历史，无需特殊配置
- 在提示词中可以引用前面阶段的内容（如"你刚才提到的X"）

### 问题5：学生答非所问，智能体不知如何应对

**原因**：缺少"判定无关话题"的处理逻辑

**解决方案**：
- 在 Workflow 中增加"判定无关话题"部分
- 策略通常为：礼貌拉回正题，重申当前任务
- 示例："我不太明白你的意思，我们还是先聊聊刚才的问题吧。"

### 问题6：学生总是无法通过某个阶段

**原因**：条件判断过于严格或不够明确

**解决方案**：
- 检查"判定回答正确"的条件是否过于苛刻
- 提供多个正确答案的判定路径（如关键词A或关键词B）
- 在"判定回答错误"中提供更明确的引导

### 问题7：多个学生同时进行训练，智能体表现不一致

**原因**：提示词中存在模糊或主观的判断条件

**解决方案**：
- 使用可验证的条件（如关键词、句式）替代主观判断
- 在 examples 中提供足够的示例，展示正确和错误的回答
- 进行多次测试，确保判断逻辑稳定

---

## 附录：完整配置示例

参考 examples.md 中的"大学生心理健康咨询模拟"示例，查看完整的配置结构和设计细节。

---

## 反馈与改进

如果你在使用过程中发现配置不符合预期，或有改进建议，请：
1. 检查本参考手册中的对应部分
2. 参考 examples.md 中的示例
3. 调整提示词中的具体条件和策略
4. 进行多轮测试，验证改进效果

本参考手册将持续更新，欢迎提供反馈和建议。
