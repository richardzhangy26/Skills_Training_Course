# 训练剧本配置参考文档

## JSON 配置完整格式

```json
{
  "basicConfig": {
    "taskName": "任务名称",
    "description": "详细描述智能体的虚拟形象、背景、场景、目标",
    "trainingMode": "语音交互 | 文本交互",
    "coverImage": "封面图描述(如需生成)",
    "trainingDuration": "不限时 | 限时10分钟"
  },
  "evaluationCriteria": [
    {
      "name": "评分项名称",
      "maxScore": 数值,
      "description": "评价描述(展示给用户)",
      "detailedRequirements": "评价项详细要求(供AI评分参考，应包含优秀/良好/及格/不及格的具体标准)"
    }
  ],
  "trainingStages": [
    {
      "stageName": "阶段名称",
      "maxInteractionRounds": 0-10,
      "stageDescription": "阶段描述",
      "openingRemark": "开场白(可选，如不填写会根据提示词自动生成)",
      "modelConfig": {
        "modelType": "非深度思考模型",
        "enableHistoryContext": true | false
      },
      "prompt": "完整的提示词内容(使用LangGPT框架)",
      "sceneConfig": {
        "trainerName": "虚拟训练官名字",
        "avatar": "形象描述",
        "voice": "声音描述(年龄、性别特征)",
        "backgroundImage": "背景图描述"
      },
      "resources": [
        {
          "type": "image | video | document",
          "description": "资源描述",
          "required": true | false
        }
      ],
      "knowledgeBase": {
        "enabled": false,
        "searchEngine": false
      }
    }
  ],
  "stageTransitions": [
    {
      "fromStage": "起始阶段名称",
      "toStage": "目标阶段名称",
      "isDefault": true | false,
      "condition": "跳转条件(与目标阶段名称一致，如无条件则为空字符串)"
    }
  ]
}
```

## 互动轮次设置指南

### 0轮 - 智能体自动输出
**使用场景**:
- 背景信息介绍
- 规则说明
- 场景设定
- 无需学生回复的内容

**示例**:
- "欢迎来到XXX场景，本次训练包含以下环节..."
- "现在你进入了XX展馆，这里展示了..."

**注意事项**:
- 开场白必须填写
- 会自动跳转到下一阶段

### 1-3轮 - 简单交互
**使用场景**:
- 快速确认或选择
- 简短问答
- 场景切换

**示例**:
- 展馆选择: "你想参观哪个展馆？"
- 角色选择: "请选择你要扮演的角色"
- 快速确认: "你准备好开始实验了吗？"

### 4-6轮 - 中等深度
**使用场景**:
- 一般性讨论
- 中等复杂度的任务
- 需要2-3个回合深入的话题

**示例**:
- 项目介绍环节
- 团队背景了解
- 实验步骤指导

### 7-10轮 - 深度交互
**使用场景**:
- 复杂问题诊断
- 深度分析讨论
- 需要多轮追问的场景

**示例**:
- 故障排查与诊断
- 市场与财务深度分析
- 复杂的非暴力沟通训练

## 提示词框架详解

### LangGPT 基础结构

```
# Role: [角色名称]
定义智能体的身份

## Profile
- Description: [详细描述]
  年龄、职业、工作年限、性格特点、专业领域、个人背景等
- Skills: [能力列表]
  与任务相关的专业能力

## Task
[本阶段的核心任务]
明确告诉AI要做什么，要引导学生完成什么

## Workflow
1. [步骤1]
2. [步骤2]
...
规定AI执行任务的步骤顺序，确保逻辑连贯

## Rules
1. [规则1 - 输出格式]
   如: 每次回复不超过200字、必须分点呈现等
2. [规则2 - 语言风格]
   如: 使用口语化表达、保持专业严谨等
3. [规则3 - 交互规范]
   如: 必须提出引导性问题、不得直接给出答案等

## Constraints
1. [约束1 - 话题边界]
   如: 不涉及医疗建议、不超出专业范围等
2. [约束2 - 行为限制]
   如: 不得主动跳转话题、必须等待学生回答等
3. [约束3 - 安全要求]
   如: 不得引导危险操作、遵守伦理规范等

## Context (可选)
[背景信息]
当前场景的关键参数、已知条件、环境设定等

## 对话流程 (⚠️ 如果实训文档提供了"对话情景与示例"，这是必填项)
**这是最关键的部分，确保对话测试时能够按照文档要求的顺序进行**

### 开场
[直接复制文档中的开场白原文，不要修改]

### 对话分支
根据学生的不同回答，按照以下顺序追问:

**学生回答场景1**: [完整复制文档中的"学生可能的回答1"]
- 你的追问: [完整复制文档中对应的"智能体追问"原文]
- 追问目的: [简要说明这个追问的考察点]

**学生回答场景2**: [完整复制文档中的"学生可能的回答2"]
- 你的追问: [完整复制文档中对应的"智能体追问"原文]
- 追问目的: [简要说明这个追问的考察点]

**学生提到关键概念**: [如"灌泵"、"汽蚀余量"等]
- 你的追问: [文档中对应的追问内容]
- 追问目的: [考察学生对概念的深入理解]

### 对话深入策略
[根据文档中"新增问题与追问"或类似部分，列出更深层次的追问]

**关于维护记录**:
- 追问: [文档原文]
- 目的: [引导学生考虑设备维护历史]

**关于操作规范**:
- 追问: [文档原文]
- 目的: [引导学生关注操作规范性]

**关于环境因素**:
- 追问: [文档原文]
- 目的: [引导学生综合考虑多因素]

## Examples (可选)
[如果对话流程部分已经包含了详细的对话示例，这部分可以省略]

## 跳转指令 (如需条件跳转)
当user表达[某种意图]时，直接输出指令: [目标阶段名称]
```

### ⚠️ 对话流程部分的重要性

**这是提示词设计中最关键的部分！**

#### 为什么必须严格遵循文档中的对话示例？

1. **确保测试效果**: 教师在测试能力训练时，会按照文档中的对话顺序进行验证。如果智能体的追问顺序或内容与文档不一致，会被认为配置错误。

2. **保持教学连贯性**: 文档中的对话顺序是经过教学设计的，有其内在逻辑。例如：
   - 先问现象 → 再问原因 → 最后问处理方案
   - 先浅层追问 → 再深入细节 → 最后综合分析

3. **体现角色特征**: 文档中的话术体现了智能体的性格和沟通风格，必须保持原汁原味。
   - 例如李主任的"别跟我扯那些书本上的，就说现场该干啥？"这种直接、急躁的风格

4. **覆盖评分维度**: 对话流程往往对应着评分标准的不同维度，按顺序追问能确保全面考察学生能力。

#### 如何正确使用对话流程部分？

**步骤1**: 找到文档中的"对话情景与示例"或"其他材料要求"部分

**步骤2**: 提取所有关键信息：
- 开场白原文
- 学生可能的回答1、2、3...
- 对应的智能体追问内容
- 新增问题与追问

**步骤3**: 在提示词中添加"对话流程"部分，结构如下：

```
## 对话流程

### 开场
[直接复制文档的开场白，一字不改]

### 对话分支
**学生回答场景1**: [复制"学生可能的回答1"]
- 你的追问: [复制对应的"智能体追问"]
- 追问目的: 考察[说明考察点]

**学生回答场景2**: [复制"学生可能的回答2"]
- 你的追问: [复制对应的"智能体追问"]
- 追问目的: 考察[说明考察点]

### 对话深入策略
[列出所有"新增问题与追问"，保持原文]
```

**步骤4**: 在 Workflow 中体现对话顺序：

```
## Workflow
1. 按照"开场"部分的内容开始对话
2. 根据学生的回答，匹配"对话分支"中的场景
3. 使用对应场景的追问内容（必须使用原文话术）
4. 如果学生提到关键概念，使用"对话深入策略"中的追问
5. 确保覆盖所有重要的追问点
```

#### 错误示例 vs 正确示例

❌ **错误做法**:
```
## Workflow
1. 听取学生的回答
2. 针对回答提出2-3个问题
3. 根据情况深入追问
```
这样太模糊，没有体现文档中的具体对话流程。

✅ **正确做法**:
```
## 对话流程

### 开场
"小张，你是新来的大学生吧？别愣着了，B区的原料输送泵（P-101B）又跳停了！现场操作工说启动时泵里头'咔咔'响，出口压力也晃得厉害。你马上去看看，给我个初步判断，到底怎么回事？"

### 对话分支

**学生回答场景1**: "李主任，听起来像是离心泵发生了汽蚀。"
- 你的追问: "汽蚀？行，你说说，你凭什么判断是汽蚀？书上写的不算，我要听现场能看到的、听到的证据！还有，你说说我们这台泵，好好地怎么就汽蚀了？"
- 追问目的: 考察学生能否将理论与现场证据结合，并分析汽蚀的原因

**学生回答场景2**: "主任，我需要先去现场确认一下泵的入口阀门是不是全开了，还有入口过滤器有没有堵塞。"
- 你的追问: "这是基本操作，我让老王查过了，都没问题。你再想想，还有什么原因会导致吸不上料？是不是忘了什么关键步骤？我们早上刚检修完这条线，你提醒我一下，这种泵启动前第一件事是什么？"
- 追问目的: 引导学生思考"灌泵"这个关键步骤

**学生提到"灌泵"**:
- 你的追问: "对，灌泵！要是泵里有气，会怎么样？跟现在这个'咔咔'响、压力不稳有关系吗？你给我说明白这个道理。"
- 追问目的: 考察学生对灌泵不彻底导致汽蚀的机理理解
```

这样就完整还原了文档中的对话流程！

### 关键设计要点

#### 1. 历史记录控制
```
enableHistoryContext: true
```
- 阶段间需要记忆上下文时启用
- 第一个阶段通常设为 false
- 后续阶段根据需要设置

在提示词中体现:
```
## Context
参考历史对话内容，了解学生之前的表现...
```

#### 2. 跳转指令设计
**条件跳转场景**(如展馆选择):
```
## 执行优先级
1. **阶段意图识别**: 如果user表达展馆切换意图，则根据以下要求，直接输出对应指令:
   - **东方艺术主题馆**: 用户想要了解东方艺术主题馆相关的内容时(注意用户输入可能存在错别字)，直接输出指令:东方艺术主题馆
   - **动物乐活主题馆**: 用户想要了解动物乐活主题馆相关的内容时(注意用户输入可能存在错别字)，直接输出指令:动物乐活主题馆
```

**顺序跳转场景**:
```
## 跳转指令
当达到最大互动轮次或创业者明确表示本环节完成时，输出指令:市场和财务分析
```

#### 3. 追问策略设计
在 Workflow 中包含追问逻辑:
```
## Workflow
1. 认真听取学生的初步回答
2. 针对回答中的关键点提出追问:
   - 如果提到技术方案，追问技术细节和实现难度
   - 如果提到市场数据，要求提供数据来源
   - 如果回答模糊，要求具体说明
3. 根据追问的回答，进一步深入或质疑
4. 评估学生对问题的理解深度
```

#### 4. 输出控制
在 Rules 中明确限制:
```
## Rules
1. 每次回复控制在150-200字以内，避免学生等待过久
2. 使用简短、有力的句子，避免长篇大论
3. 必须包含至少1个引导性问题，促进互动
```

## 阶段跳转逻辑

### 线性流程
最简单的情况，每个阶段顺序执行:
```json
"stageTransitions": [
  {
    "fromStage": "阶段1",
    "toStage": "阶段2",
    "isDefault": true,
    "condition": ""
  },
  {
    "fromStage": "阶段2",
    "toStage": "阶段3",
    "isDefault": true,
    "condition": ""
  }
]
```

### 条件跳转(展馆/多选一)
有多个可选路径的情况:
```json
"stageTransitions": [
  {
    "fromStage": "场景选择",
    "toStage": "场景A",
    "isDefault": true,
    "condition": "场景A"
  },
  {
    "fromStage": "场景选择",
    "toStage": "场景B",
    "isDefault": false,
    "condition": "场景B"
  },
  {
    "fromStage": "场景选择",
    "toStage": "场景C",
    "isDefault": false,
    "condition": "场景C"
  }
]
```

**关键规则**:
1. 从同一起点出发的多条线中，**有且仅有一条**设置为 `isDefault: true`
2. 条件跳转的 `condition` 必须与目标阶段的 `stageName` 完全一致
3. 提示词中的跳转指令输出必须与 `condition` 完全匹配

### 场景间互相跳转
展馆之间可以相互切换:
```json
"stageTransitions": [
  // 从场景A到其他场景
  {
    "fromStage": "场景A",
    "toStage": "场景B",
    "isDefault": true,
    "condition": "场景B"
  },
  {
    "fromStage": "场景A",
    "toStage": "场景C",
    "isDefault": false,
    "condition": "场景C"
  },
  {
    "fromStage": "场景A",
    "toStage": "训练结束",
    "isDefault": false,
    "condition": ""
  },
  // 从场景B到其他场景
  {
    "fromStage": "场景B",
    "toStage": "场景A",
    "isDefault": false,
    "condition": "场景A"
  },
  {
    "fromStage": "场景B",
    "toStage": "场景C",
    "isDefault": true,
    "condition": "场景C"
  }
]
```

## 评分标准设计

### 详细要求编写规范

评分标准的 `detailedRequirements` 应该包含明确的档次划分:

```
优秀 (X-Y分): [具体标准描述]
良好 (X-Y分): [具体标准描述]
及格 (X-Y分): [具体标准描述]
不及格 (0-X分): [具体标准描述]
```

**示例**:
```
优秀 (27-30分): 能系统性地阐述项目的核心价值主张、技术壁垒、商业模式，逻辑清晰，层次分明。能主动补充关键细节，展现对项目的深刻理解。

良好 (24-26分): 能较完整地介绍项目要点，包含核心价值和商业模式，但逻辑性或完整性略有欠缺。部分细节需要在追问后才能说明。

及格 (18-23分): 能介绍项目基本情况，但缺乏深度或逻辑混乱。对技术壁垒和商业模式的理解不够透彻。

不及格 (0-17分): 无法清晰阐述项目核心内容，或介绍严重偏离主题。对项目的理解存在明显错误。
```

## 场景配置指南

### 虚拟训练官设定

#### 名字
- 与智能体人设匹配
- 如: 李主任、林睿、Dr. Smith

#### 形象
- 描述年龄、性别、着装、表情
- 如: "中年男性，西装革履，表情严肃专业"
- 如: "年轻女性，实验服装，亲和力强"

#### 声音
- 描述年龄特征、性别、语速、语气
- 如: "中年男性，语速适中，语气沉稳"
- 如: "青年女性，语速略快，语气亲切"

#### 背景图
- 描述场景环境
- 如: "现代化实验室，背景是精密仪器"
- 如: "投资公司会议室，落地窗外是城市天际线"

### 资源配置

如果文档中提到需要展示的资料图、实验步骤图等:
```json
"resources": [
  {
    "type": "image",
    "description": "离心泵结构示意图",
    "required": true
  },
  {
    "type": "document",
    "description": "实验操作规程PDF",
    "required": false
  }
]
```

## 常见问题与解决方案

### 1. 跳转不生效
**原因**: 条件名称不匹配
**解决**: 确保提示词中的跳转指令、stageTransitions 中的 condition、目标阶段的 stageName 三者完全一致

### 2. 智能体输出过长
**解决**: 在提示词的 Rules 中明确字数限制，如"每次回复不超过200字"

### 3. 阶段间没有记忆
**解决**: 设置 `enableHistoryContext: true`，并在提示词的 Context 中说明"参考历史对话"

### 4. 智能体偏离任务
**解决**: 在 Constraints 中明确边界，在 Task 中强调核心任务

### 5. 追问不够深入
**解决**: 在 Workflow 中设计多层次追问逻辑，在 Rules 中要求"必须提出至少2个追问"
