---
name: training-script-generator
description: 根据实训任务文档自动生成完整的能力训练剧本配置。生成包含阶段名称、互动轮次、提示词、场景配置的Markdown格式配置文件，提示词会引用文档中的对话示例以确保对话效果符合预期。关键词:实训、能力训练、训练剧本、智能体配置、评分标准、生成配置
allowed-tools: Read, Grep, Glob, Write
---

# 训练剧本生成器

根据实训任务文档，自动生成完整的能力训练剧本配置，输出 Markdown 格式的易读配置文件。

## 使用时机

当用户需要创建或配置能力训练时使用此 skill，典型场景包括:
- 用户提供了实训任务文档，需要生成训练剧本配置
- 用户询问如何配置能力训练的各个阶段
- 用户需要为教学场景设计智能体对话流程
- 用户提到"生成训练剧本"、"配置能力训练"、"实训任务配置"等关键词

## Instructions

### 第一步: 获取并分析实训任务文档

1. 通过 Read 工具读取用户提供的实训任务文档
2. 从文档路径中提取任务名称（去掉路径和".md"扩展名），用于创建输出文件夹
3. 提取以下关键信息:
   - **任务目标**: 教学意图、能力培养目标
   - **任务描述**: 智能体人设(角色、性格、背景)、任务流程、阶段划分
   - **对话情景与示例** (如有):
     - 开场白的具体内容
     - 学生可能的回答和智能体追问
     - 对话的流程和逻辑
   - **其他材料要求**: 背景图、资源文件等需求

### 第二步: 设计训练阶段

根据任务流程设计合理的阶段划分:

1. **识别阶段节点**
   - 通常结构: 开场介绍 → 任务执行(可分多个子阶段) → 总结评价
   - 如有多个独立场景(如展馆)，需要设置场景选择阶段
   - 如有多角色扮演，为每个角色创建独立阶段
   - 为每个阶段编写清晰的阶段描述（1-2句话说明该阶段的核心目标）

2. **确定互动轮次** (参考 reference.md)
   - 0轮: 智能体自动输出(背景介绍、规则说明)
   - 1-3轮: 简单问答或快速交互
   - 4-6轮: 中等深度讨论
   - 7-10轮: 深度分析或复杂诊断场景

3. **编写开场白**
   - 紧扣场景和角色设定
   - 语言风格符合智能体人设
   - 明确告知学生当前任务

### 第三步: 为每个阶段生成提示词

使用 LangGPT 框架设计高质量提示词，必须包含以下结构:

```
# Role: [角色名称]

## Profile
- Description: [详细的角色描述 - 年龄、背景、性格、专业领域]
- Skills: [核心能力列表]

## Rules
1. **输出格式要求**: [字数限制、结构要求]。例如：每次回复必须 300-500 字，讲解需非常具体。
2. **任务聚焦范围**: [本环节聚焦的核心内容和边界]。例如：本环节聚焦于线缆类型、接口标准及连接规范。
3. **回避意图应对**: 当识别到用户表达"不知道""不太清楚""换个问题吧""这个问题太难了"等无法解答或希望更换问题的意图时，需保持角色语气，先简单回应以缓解对话氛围，随后立即围绕当前知识点提出一个难度更低、更贴近基础认知的新问题，避免重复已提问题。
4. **答非所问应对**: 当识别到用户回应与当前所提问题答非所问时，需用角色语气委婉提醒，引导对话回归主题（如"您说的这个我有点没跟上，是不是和我问的XX问题有关呀？我再把问题说一遍哦——XX"），提醒后重复原问题或结合原问题核心简化提问，确保互动聚焦当前知识点。
5. **沉默/敷衍应对**: 当用户仅回复"嗯""好""哦"等敷衍性内容时，需友好追问引导用户展开回答，如"能再具体说说吗？"或提供选项降低回答难度。
6. **语言风格要求**: [角色的语言风格]。例如：所有输出必须是纯粹的对话文本，不要输出括号的内容，包括肢体动作、语气形态描述。
7. **轮次限制要求**: [如有具体要求，说明轮次限制]。例如：总共介绍3个接口和线缆概念后即可进入下一环节，总介绍概念务必不要超过3个。

## Workflow
详细描述本阶段的对话流程，说明每轮需要做什么，每轮的字数要求：

1. **[第一步名称（字数范围）]**：
   - [具体工作内容1]
   - [具体工作内容2]
   - [与学生的互动方式]

2. **[第二步名称（字数范围）]**：
   - [具体工作内容1]
   - [具体工作内容2]
   - [深入的讨论方向]

3. **[第三步名称（字数范围）]**：
   - [总结性内容]
   - [为下一环节的过渡]

## Constraints
1. [边界限制 - 不涉及的话题范围]
2. [行为约束 - 不得做的事情]
3. [安全要求]

## Context (如适用)
[当前场景的背景信息、关键参数、已知条件做知识库]

## Examples (如文档提供了对话示例)
如果文档中有"对话情景与示例"部分，在这里引用关键的对话示例：
- 开场白: [文档原文]
- 典型追问: [文档中的追问示例]
目的是让 AI 参考这些示例的风格和逻辑进行对话。

## Intent Switch (如需条件跳转)
**⚠️ 重要**: 跳转必须基于用户的确定性回答，不能基于主观判断！

描述任务切换的条件和规则：
- 什么情况下可以切换到下一阶段（基于明确的完成标志或用户确认）
- 智能体如何引导用户进行过渡
- 具体的跳转指令触发条件

**封闭式问题示例**:
- "你准备好进入下一阶段了吗？请回复'是'或'否'"
- "请问你是学生还是老师？"
- "你选择哪个方案？A、B 还是 C？"

**跳转指令格式**:
当用户回答"[具体答案内容]"时，输出指令: [目标阶段名称]

**注意**: 跳转指令不在对话输出内容中展示给用户，仅作为系统内部指令。

**错误示例** ❌:
- 当完成设计计算全流程，学生确认提交材料准备就绪后，输出指令: 提交材料评价
- 当学生充分理解设计任务后，输出指令: 工艺流程设计

**正确示例** ✅:
- 当用户回答"是"或"准备好了"时，输出指令: 工艺流程设计
- 当用户选择"板式塔"时，输出指令: 课题背景调查
```

**提示词设计要点**:
- **开场白**: 如果文档提供了开场白，在 openingRemark 字段中使用原文
- **对话示例**: 如果文档有对话示例，在 Examples 部分引用，让 AI 学习其风格
- **Rules - 输出格式要求**: 在第一条规则中限制输出字数（建议 300-500 字或其他合理范围），确保回复具体且详细
- **Rules - 任务聚焦范围**: 在第二条规则中明确本环节的核心内容和边界，避免跑题
- **Rules - Bad Case 处理**: Rules 3-5 条必须包含回避意图、答非所问、沉默敷衍三种情况的应对策略，根据角色特点定制话术
- **Rules - 语言风格要求**: 明确角色的语言风格，如是否包含动作描述、语气特点等
- **Rules - 轮次限制要求**: 如有明确的互动次数或任务数量限制，在此说明
- **Workflow**: 这是最重要的部分，详细描述本阶段的完整对话流程，包括每轮的工作内容、字数范围、互动方式。**特别重要**: 在 Workflow 的最后一步，明确说明何时向用户提出封闭式确认问题（如"你准备好进入下一阶段了吗？请回复是或否"），为 Intent Switch 做准备
- **Intent Switch**: 描述任务切换的条件和规则，必须基于用户的具体回答内容设计跳转条件，避免主观判断。明确"当用户回答'XX'时"的触发条件
- **历史记录**: 阶段间需要记忆则在 Context 中说明"参考历史对话"

### 第四步: 生成 Markdown 格式配置

使用易读的 Markdown 格式组织配置内容，包含:

```markdown
# [任务名称] - 训练剧本配置

## 📋 基础配置
- **任务名称**: [...]
- **任务描述**: [...]
- **智能体角色**: [...]
- **目标受众**: [...]

## 📝 训练阶段

### 阶段1: [阶段名称]

**阶段描述**: [简要说明本阶段的核心目标和任务，1-2句话]

**互动轮次**: X轮

**开场白**:
```
[开场白原文]
```

**提示词**:
```
# Role: [角色名称]

## Profile
- Description: [...]
- Skills: [...]

## Rules
1. **输出格式要求**: [字数限制、结构要求]
2. **任务聚焦范围**: [本环节聚焦的核心内容和边界]
3. **回避意图应对**: [根据角色特点定制的回避应对策略]
4. **答非所问应对**: [根据角色特点定制的跑题应对策略]
5. **沉默/敷衍应对**: [根据角色特点定制的敷衍应对策略]
6. **语言风格要求**: [角色的语言风格]
7. **轮次限制要求**: [如有具体要求]

## Workflow
详细描述本阶段的对话流程：

1. **[第一步名称（字数范围）]**：
   - [具体工作内容]

2. **[第二步名称（字数范围）]**：
   - [具体工作内容]

3. **[第三步名称（字数范围）]**：
   - [总结与确认]

## Constraints
1. [...]
2. [...]

## Context
[...]

## Intent Switch
[描述任务切换条件和引导方式]
当用户回答"[具体内容]"时，输出指令: [目标阶段名称]
（不在输出内容中展示）
```

**场景配置**:
- 背景: [...]
- 关键设备/道具: [...]
- 特殊要求: [...]

---

[其他阶段...]

## 🔀 阶段跳转关系

1. [阶段A] → [阶段B]
   - 触发条件: [...]
   - 跳转指令: `[...]`

2. [阶段B] → [阶段C]
   - 触发条件: [...]
   - 跳转指令: `[...]`

## 💡 配置说明

### 设计思路
[阶段设计的整体思路]

### 跳转逻辑
[阶段间跳转的逻辑说明]

### 特殊处理
[需要特别注意的配置点]

### 优化建议
[后续可以改进的方向]
```

### 第五步: 创建输出文件夹并保存

1. 在实训任务文档所在目录创建以任务名称命名的文件夹（如果不存在）
2. 将生成的 Markdown 配置文件保存到该文件夹中，文件名为 `训练剧本配置.md`
3. 输出内容应包含：
   - 基础配置（任务名称、描述、智能体角色、目标受众）
   - 训练阶段（每个阶段包含：阶段描述、互动轮次、开场白、提示词、场景配置）
   - 阶段跳转关系
   - 配置说明（设计思路、跳转逻辑、特殊处理、优化建议）
4. 向用户输出配置摘要和文件保存路径

## Examples

参见 examples.md 文件中的完整示例。

## Important Notes

1. **严格基于文档**: 不要随意添加文档中没有的内容
2. **保持信息完整**: 智能体人设、对话示例必须完整保留
3. **阶段描述清晰**: 每个阶段都要有简洁明确的阶段描述（1-2句话）
4. **开场白原文**: 如果文档提供了开场白，必须使用原文
5. **引用对话示例**: 如果文档有对话示例，在提示词的 Examples 部分引用关键示例
6. **提示词结构清晰**:
   - Rules 部分要简洁明确，涵盖输出格式、任务范围、Bad Case 处理、语言风格、轮次限制
   - Workflow 部分要详细具体，说明每轮的工作内容和字数要求
   - Intent Switch 部分要描述任务切换的条件和引导方式
7. **⚠️ Intent Switch 设计**:
   - Intent Switch 名称必须与目标阶段名称完全一致
   - **跳转条件必须基于用户的确定性回答，不能基于主观判断**
   - 在 Workflow 的最后一步，明确说明何时向用户提出封闭式问题
   - Intent Switch 中要描述智能体如何引导过渡，以及具体的跳转指令触发条件
   - 跳转指令格式必须是："当用户回答'[具体内容]'时，输出指令: [目标阶段名称]"
   - 避免使用模糊条件如"当学生理解后"、"当任务完成时"等
8. **Markdown 格式**: 使用清晰的标题层级和代码块，方便阅读和复制
9. **自动保存**: 使用 Write 工具将配置保存到以任务命名的文件夹中
10. **不生成评分标准**: 配置文件中暂时不需要包含评价标准部分

## Intent Switch 设计最佳实践

Intent Switch（任务切换规则）的设计直接影响训练流程的稳定性。遵循以下原则可以确保跳转准确触发：

### 核心原则

1. **封闭式问题优先**: 在阶段结束前，必须向用户提出有明确选项的问题
2. **基于确定性回答**: 跳转条件必须是用户的具体回答内容，而非对用户状态的主观判断
3. **清晰的触发词**: 在 Intent Switch 中明确列出触发跳转的关键词或短语
4. **过渡引导**: Intent Switch 应该包含智能体如何引导用户进行过渡的说明

### 设计模式

#### 模式1: 确认式跳转（最常用）
```
Workflow 最后一步：当完成XX讨论后，询问用户"你准备好进入下一阶段了吗？请回复'是'或'否'"。

Intent Switch：
当完成XX讨论，并且学生表示准备好（回答"是"、"准备好了"、"可以"等）时，智能体可以用"太好了，那我们现在进入下一阶段"进行过渡，并输出指令：下一阶段名称。（不在输出内容中展示）
```

#### 模式2: 选择式跳转（多分支场景）
```
Workflow 最后一步：在了解学生需求后，询问"请选择你要参观的展馆：A.历史馆 B.科技馆 C.艺术馆"。

Intent Switch：
根据学生的选择，智能体引导学生进入对应的展馆：
- 当用户选择"A"或"历史馆"时，输出指令: 历史馆参观
- 当用户选择"B"或"科技馆"时，输出指令: 科技馆参观
- 当用户选择"C"或"艺术馆"时，输出指令: 艺术馆参观
（跳转指令不在对话输出内容中展示）
```

#### 模式3: 角色确认式跳转
```
Workflow 最后一步：询问用户"请问你是学生还是老师？"。

Intent Switch：
根据用户的身份选择，进入相应的流程：
- 当用户回答"学生"时，输出指令: 学生设计流程
- 当用户回答"老师"时，输出指令: 老师出题流程
（跳转指令不在对话输出内容中展示）
```

### 错误示例 vs 正确示例

| 错误示例 ❌ | 问题 | 正确示例 ✅ |
|------------|------|------------|
| 当完成设计计算全流程，学生确认提交材料准备就绪后 | 条件太主观，模型无法判断何时"完成" | 询问"你已完成设计计算并准备提交材料了吗？请回复'是'或'否'"，当用户回答"是"时 |
| 当学生充分理解设计任务后 | "充分理解"无法量化判断 | 询问"你对设计任务还有疑问吗？如果没有疑问请回复'明白了'"，当用户回答"明白了"或"没有疑问"时 |
| 当讨论达到预期效果时 | "预期效果"是主观判断 | 在讨论X个关键点后，询问"我们已讨论了XX，你准备好进入下一环节了吗？"，当用户回答"是"时 |
| 当学生提交图纸后 | 依赖外部行为，对话中无法确认 | 询问"你的图纸已经绘制完成了吗？完成后请回复'已完成'"，当用户回答"已完成"时 |

### 提示词中的完整示例

**阶段：课题背景调查**

Workflow（节选最后一步）：
```
3. **总结与确认（50-80字）**：
   - 总结学生收集到的关键信息
   - 询问"你已经完成资料收集并理解设计要求了吗？准备好的话请回复'是'"
   - 等待学生确认
```

Intent Switch：
```
当学生完成资料收集并掌握足够的背景信息后，询问确认。当用户回答"是"或"准备好了"或"可以"时，智能体说"很好，那我们进入工艺流程设计环节"，并输出指令：工艺流程设计。（不在输出内容中展示）
```

### 常见陷阱

1. **避免依赖隐式状态**: 不要假设模型能判断"学生是否理解"、"任务是否完成"
2. **避免开放式问题触发跳转**: "你还有什么问题吗？"这类问题的回答不确定，不适合作为跳转触发
3. **避免多条件组合**: 尽量使用单一明确的条件，不要"当A且B且C时"这样的复杂条件

## Special Scenarios

### 展馆/多选一场景
- 第1阶段: "场景选择" (轮次1-3, 询问选择)
- 第2-N阶段: 各场景详细内容
- 提示词需包含执行优先级和意图识别逻辑
- 跳转设置: 仅一条默认线，其他为条件跳转

### 多角色扮演
- 为每个角色创建独立阶段
- 提示词中明确角色切换标识
- 开场白要说明当前角色

### 紧急故障诊断
- 开场白营造紧迫感
- 设计多层次追问(现象→原因→处理)
- 互动轮次建议 6-10轮

## Version History

- v1.2 (2025-12-12): 重大结构调整
  - 将 Rules 中的"任务目标"独立为 Workflow 部分，详细说明每轮的工作内容和字数要求
  - 简化 Rules 结构，改为：输出格式、任务范围、Bad Case 处理、语言风格、轮次限制
  - 将"跳转指令"改为"Intent Switch"，强调任务切换规则和过渡引导
  - 更新所有相关示例和最佳实践，使其符合新的结构规范
- v1.1 (2025-11-28): 优化跳转指令设计规范，强调必须基于用户确定性回答触发跳转，新增"跳转指令设计最佳实践"章节
- v1.0 (2025-11-24): 初始版本，支持基本的训练剧本生成