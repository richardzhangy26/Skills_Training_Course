# 多模型接入使用说明

## 概述

`auto_script_train_5characters.py` 现已支持三种 LLM 模型调用方式：
1. **Doubao (OpenAI SDK)** - 默认模式
2. **Doubao (POST API)** - 公司内部 API
3. **DeepSeek (OpenAI SDK)** - 新增的 DeepSeek 模型

## 环境变量配置

在 `.env` 文件中配置以下变量：

```bash
# 模型配置
MODEL_TYPE=doubao_sdk  # doubao_sdk, doubao_post, deepseek_sdk

# Doubao API Key
ARK_API_KEY=your_doubao_api_key
DOUBAO_MODEL=doubao-seed-1-6-251015

# 公司的豆包api-key (POST API模式使用)
LLM_API_KEY=sk-xxxxx
LLM_MODEL=Doubao-1.5-pro-32k
LLM_API_URL=http://llm-service.polymas.com/api/openai/v1/chat/completions
LLM_SERVICE_CODE=SI_Ability
USE_POST_API=true

# DeepSeek API Key
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_MODEL=deepseek-chat

# 登录后请求的Authorization和Cookie
AUTHORIZATION=xxxx
COOKIE=xxxx

# 任务ID
TASK_ID=xxxx
```

## 使用方法

### 1. 运行脚本

```bash
python auto_script_train_5characters.py
```

### 2. 选择运行模式

脚本启动后，选择运行方式：
```
请选择运行方式：
1. 交互式运行（推荐）
2. 自动化运行（需要预设答案）
3. 大模型自主选择回答（LLM 自动生成答案）
```

### 3. 选择 LLM 模型（模式3）

如果选择模式3，会提示选择 LLM 模型：
```
请选择 LLM 模型：
1. Doubao (OpenAI SDK)
2. Doubao (POST API)
3. DeepSeek (OpenAI SDK)
```

### 4. 配置 DeepSeek

要使用 DeepSeek 模型，需要：
1. 获取 DeepSeek API Key（从 https://platform.deepseek.com/ 获取）
2. 在 `.env` 文件中设置 `DEEPSEEK_API_KEY`
3. 运行脚本时选择模式3，然后选择选项3

## DeepSeek 模型特点

### 优点
1. **成本较低** - 相比 Doubao，DeepSeek 的 API 调用成本更低
2. **响应速度快** - DeepSeek 模型响应通常较快
3. **支持长上下文** - 支持 128K 上下文长度

### 注意事项
1. **API 端点不同** - DeepSeek 使用 `https://api.deepseek.com` 作为 base_url
2. **模型名称** - 默认使用 `deepseek-chat` 模型
3. **计费方式** - 按 token 计费，注意控制生成长度

## 测试 DeepSeek 接入

可以使用测试脚本验证 DeepSeek 接入：

```bash
# 设置测试环境变量
export DEEPSEEK_API_KEY=your_api_key

# 运行测试
python test_deepseek.py
```

## 故障排除

### 1. DeepSeek 客户端初始化失败
- 检查 `DEEPSEEK_API_KEY` 是否正确
- 检查网络连接是否可以访问 `https://api.deepseek.com`

### 2. 模型调用失败
- 检查 API Key 是否有足够的额度
- 检查模型名称是否正确（默认 `deepseek-chat`）

### 3. 响应内容为空
- 检查生成参数（temperature、max_tokens 等）
- 检查系统提示词是否合理

## 高级配置

### 自定义模型参数
可以在代码中调整以下参数：
- `temperature` (默认 0.85) - 控制生成随机性
- `max_tokens` (默认 1000) - 控制生成最大长度
- `top_p` (默认 0.95) - 核采样参数
- `frequency_penalty` (默认 0.3) - 频率惩罚
- `presence_penalty` (默认 0.2) - 存在惩罚

### 并发运行
支持同时运行多个学生角色，每个角色使用独立的模型实例。

## 更新日志

### v2.1 (当前版本)
- ✅ 新增 DeepSeek 模型支持
- ✅ 支持三种模型调用方式
- ✅ 交互式模型选择界面
- ✅ 完整的错误处理和日志记录

### v2.0
- ✅ 支持 Doubao SDK 和 POST API
- ✅ 5种学生角色模拟
- ✅ 对话示例和知识库加载
- ✅ 并发运行支持