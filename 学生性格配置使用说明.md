# 学生性格配置使用说明

## 概述
`auto_script_train_5characters.py` 中的学生性格配置现已支持通过 JSON 文件进行自定义配置。用户可以通过配置文件修改 S1-S5 五种预设性格的细节，无需修改源代码。

## 配置文件

### 1. 配置文件位置和优先级
程序按以下顺序查找配置文件：

1. **自定义配置文件**：`student_profiles.custom.json`（当前工作目录）
2. **默认配置文件**：`student_profiles.json`（项目根目录）
3. **内置默认配置**：如果以上文件都不存在，使用硬编码的默认配置

### 2. 配置文件结构
配置文件采用 JSON 格式，基本结构如下：

```json
{
  "metadata": {
    "version": "1.0",
    "createdAt": "2025-12-08T10:00:00Z",
    "description": "学生性格配置文件",
    "defaultProfile": "S2"
  },
  "profiles": {
    "S1": {
      "label": "S1 沉默寡言的学生",
      "description": "内向不主动表达，只给最简短的回应，常用词重复。",
      "speech_habit": "常说'嗯''好''不知道'，回答多为1-2句甚至只有词语。",
      "style": "语气克制、信息量少，除非被追问不会展开。",
      "test_goal": "测试AI是否能主动引导、追问，避免对话中断。",
      "enabled": true
    },
    "S2": {
      "label": "S2 话多跑题的学生",
      "description": "兴奋健谈，喜欢分享各种细节，常把话题带离当前问题。",
      "speech_habit": "回答冗长跳跃，经常夹杂与问题弱相关的经历或感受。",
      "style": "语速快、情绪高涨，想到什么就说什么，很难保持中心。",
      "test_goal": "测试AI的话题收束能力和耐心引导能力。",
      "enabled": true
    },
    "S3": { ... },
    "S4": { ... },
    "S5": { ... }
  }
}
```

### 3. 配置字段说明

#### 3.1 必填字段
- `label`：性格标签（显示名称）
- `description`：性格描述
- `speech_habit`：说话习惯
- `style`：表达风格
- `test_goal`：测试目标

#### 3.2 可选字段
- `enabled`：是否启用该性格（默认：`true`）
- 其他自定义字段（可在 `custom_fields` 中添加）

## 使用示例

### 示例1：修改单个性格
要修改 S1 性格的标签和描述，创建 `student_profiles.custom.json`：

```json
{
  "profiles": {
    "S1": {
      "label": "自定义沉默学生",
      "description": "这是自定义的沉默学生描述",
      "speech_habit": "自定义说话习惯描述"
    }
  }
}
```

### 示例2：禁用某个性格
要禁用 S2 性格：

```json
{
  "profiles": {
    "S2": {
      "enabled": false
    }
  }
}
```

### 示例3：完全自定义所有性格
```json
{
  "metadata": {
    "defaultProfile": "S3"
  },
  "profiles": {
    "S1": {
      "label": "内向型学生",
      "description": "完全自定义的描述",
      "speech_habit": "自定义说话习惯",
      "style": "自定义表达风格",
      "test_goal": "自定义测试目标",
      "enabled": true
    },
    "S2": {
      "label": "外向型学生",
      "description": "另一个自定义描述",
      "speech_habit": "另一个说话习惯",
      "style": "另一个表达风格",
      "test_goal": "另一个测试目标",
      "enabled": true
    }
    // ... 其他性格
  }
}
```

## 配置合并规则

### 1. 字段级合并
- 用户配置文件中提供的字段会覆盖默认配置
- 未提供的字段保留默认值
- 支持部分字段修改，无需提供完整配置

### 2. 启用/禁用控制
- 通过 `enabled` 字段控制性格是否在选项列表中显示
- 默认值为 `true`（启用）
- 设置为 `false` 可隐藏该性格选项

### 3. 错误处理
- **配置文件不存在**：使用内置默认配置，打印警告
- **JSON格式错误**：使用内置默认配置，打印错误详情
- **字段缺失**：使用默认值填充缺失字段
- **无效性格键名**：忽略无效键名，使用默认配置

## 程序行为变化

### 1. 配置加载
程序启动时自动加载配置文件，加载过程：
1. 查找并加载配置文件
2. 验证配置格式和字段
3. 合并用户配置和默认配置
4. 初始化 `student_profiles` 属性

### 2. 性格选择
- `prompt_student_profile()` 方法只显示 `enabled: true` 的性格
- 支持通过配置文件修改性格的显示标签和描述
- 保持现有的交互式选择界面

### 3. 向后兼容
- 保持现有的 S1-S5 键名
- 现有代码无需修改
- 无配置文件时自动使用内置默认配置

## 最佳实践

### 1. 配置文件管理
1. **保留默认配置**：不要修改 `student_profiles.json`，将其作为参考
2. **使用自定义配置**：创建 `student_profiles.custom.json` 进行个性化配置
3. **版本控制**：将 `student_profiles.example.json` 纳入版本控制
4. **备份配置**：定期备份自定义配置

### 2. 配置验证
1. **格式检查**：使用 JSON 验证工具检查配置文件格式
2. **字段验证**：确保必填字段存在
3. **测试验证**：修改配置后运行测试验证功能正常

### 3. 调试技巧
1. **查看加载日志**：程序启动时会显示加载的配置文件路径
2. **测试配置**：使用提供的测试脚本验证配置
3. **逐步修改**：每次只修改少量配置，验证后再继续

## 故障排除

### 常见问题

#### 问题1：配置修改未生效
**可能原因**：
1. 配置文件路径错误
2. JSON 格式错误
3. 字段名称拼写错误

**解决方案**：
1. 检查配置文件路径和名称
2. 使用 JSON 验证工具检查格式
3. 查看程序启动时的加载日志

#### 问题2：性格选项不显示
**可能原因**：
1. `enabled` 字段设置为 `false`
2. 配置文件未正确加载

**解决方案**：
1. 检查 `enabled` 字段值
2. 确认配置文件已正确加载

#### 问题3：程序启动失败
**可能原因**：
1. 配置文件格式严重错误
2. 必填字段缺失

**解决方案**：
1. 暂时移除配置文件，使用默认配置
2. 检查并修复配置文件

## 相关文件

1. `student_profiles.example.json` - 配置模板和文档
2. `student_profiles.json` - 默认配置文件
3. `auto_script_train_5characters.py` - 主程序文件
4. `学生性格配置使用说明.md` - 本文档

## 更新日志

### v1.0 (2025-12-08)
- 初始版本：支持学生性格 JSON 配置文件
- 支持字段级配置覆盖
- 支持启用/禁用控制
- 完善的错误处理和回退机制
- 保持向后兼容性